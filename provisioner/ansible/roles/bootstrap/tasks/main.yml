# Playbook for bootstraping the hadoop cluster nodes

- name: RSYNC Bigtop home directory to /bigtop-home
  ansible.posix.synchronize:
    src: '{{bigtop_home}}/'
    dest: '{{remote_bigtop_home}}'
  become: True

- name: Puppetize the machines
  ansible.builtin.command: '{{remote_bigtop_home}}/bigtop_toolchain/bin/puppetize.sh'
  become: True
  register: puppetize_out
- debug: 
    var: puppetize_out.stdout_lines
- debug: 
    var: puppetize_out.stderr_lines

- name: Install puppet modules
  ansible.builtin.command: './gradlew toolchain-puppetmodules'
  args:
    chdir: '{{remote_bigtop_home}}'
  become: True
  register: puppetmodules_out
- debug: 
    var: puppetmodules_out.stdout_lines
- debug: 
    var: puppetmodules_out.stderr_lines  

- name: Setup env on the machines
  ansible.builtin.command: '{{remote_bigtop_home}}/provisioner/utils/setup-env-{{env_setup_distro}}.sh {{use_local_repo}}'
  become: True
  register: setupenv_out  
- debug: 
    var: setupenv_out.stdout_lines
- debug: 
    var: setupenv_out.stderr_lines    
    
- name: RSYNC hiera.yaml to /etc/puppet
  ansible.posix.synchronize:
    src: '{{playbook_dir}}/config/hiera.yaml'
    dest: '{{remote_puppet_home}}/hiera.yaml'
  become: True

- name: RSYNC hieradata to /etc/puppet/
  ansible.posix.synchronize:
    src: '{{playbook_dir}}/config/hieradata/'
    dest: '{{remote_puppet_home}}/hieradata'
  become: True